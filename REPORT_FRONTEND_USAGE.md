# 报表生成功能前端使用说明

## 功能概述

现在你可以在网页界面中直接使用报表生成功能了！系统提供了三类报表的生成：

1. **单张票据审核报告** - 针对单张发票的详细审核报告
2. **周期汇总报表** - 按时间周期（月/周/项目）的汇总统计
3. **审计追溯与整改清单** - 需要整改的票据清单

## 使用步骤

### 1. 启动服务

```bash
cd src
python app.py
```

服务将在 `http://localhost:9000` 启动。

### 2. 登录系统

访问 `http://localhost:9000`，使用你的账号登录。

### 3. 进入财务报表页面

在左侧导航栏中，点击 **"财务报表"** 菜单项。

### 4. 生成报表

#### 方式一：单张票据审核报告

1. 在报表页面顶部，点击 **"单张票据审核报告"** 标签
2. 输入票据ID（可以从"发票管理"页面获取）
3. 选择是否保存为文件
4. 点击 **"生成报告"** 按钮
5. 报告将显示在右侧，并自动渲染为Markdown格式

**如何获取票据ID：**
- 进入"发票管理"页面
- 在"已生成凭证"标签页中，查看发票列表
- 票据ID通常显示在表格中，或者可以通过浏览器开发者工具查看

#### 方式二：周期汇总报表

1. 点击 **"周期汇总报表"** 标签
2. 选择开始日期和结束日期（可选）
3. 选择周期类型（月报/周报/项目报）
4. 输入周期标签（如"2025年10期"）
5. 选择是否保存为文件
6. 点击 **"生成报表"** 按钮

#### 方式三：审计追溯与整改清单

1. 点击 **"审计追溯与整改清单"** 标签
2. 选择开始日期和结束日期（可选）
3. 选择是否保存为文件
4. 点击 **"生成清单"** 按钮

#### 方式四：生成所有报表

1. 点击 **"生成所有报表"** 标签
2. 填写时间范围和周期信息
3. 点击 **"生成所有报表"** 按钮
4. 系统会生成三类报表，可以通过顶部标签切换查看

## 报表内容说明

### 单张票据审核报告包含：
- 票据基本信息
- 审核结论（通过/需补充/不合规）
- 证据链
- 风险点分析
- 修改建议

### 周期汇总报表包含：
- 本期花费结构（按类别、供应商统计）
- 合规率统计
- 异常类型分布
- Top供应商和Top类别

### 审计追溯与整改清单包含：
- 需要补材料的票据（按优先级排序）
- 超标准的票据
- 疑似重复/异常的票据
- 汇总统计

## 报表保存

如果勾选了"保存为文件"选项，报表会自动保存到 `data/reports/` 目录下：
- 单张票据审核报告：`invoice_audit_{document_id}_{timestamp}.md`
- 周期汇总报表：`period_summary_{period_type}_{timestamp}.md`
- 审计追溯与整改清单：`audit_trail_{timestamp}.md`

## 注意事项

1. **票据ID获取**：如果不知道票据ID，可以先在"发票管理"页面查看已上传的发票列表
2. **时间范围**：如果不填写时间范围，系统会查询所有票据数据
3. **生成时间**：报表生成需要调用AI服务，可能需要几秒钟时间，请耐心等待
4. **单张票据报告限制**：当票据数量超过50张时，"生成所有报表"功能不会为每张票据生成单独报告

## 故障排查

### 如果报表生成失败：

1. 检查浏览器控制台是否有错误信息
2. 确认后端服务正在运行
3. 检查是否配置了 `DEEPSEEK_API_KEY`（报表生成需要AI服务）
4. 查看后端日志获取详细错误信息

### 如果看不到报表内容：

1. 确认浏览器支持JavaScript
2. 检查网络连接是否正常
3. 查看浏览器控制台是否有JavaScript错误

## 示例

### 生成单张票据审核报告示例：

1. 进入"发票管理"页面
2. 上传一张发票
3. 等待处理完成后，记录票据ID（通常在文件名或URL中）
4. 进入"财务报表"页面
5. 选择"单张票据审核报告"
6. 输入票据ID，点击生成

### 生成月度汇总报表示例：

1. 进入"财务报表"页面
2. 选择"周期汇总报表"
3. 设置开始日期：2025-01-01
4. 设置结束日期：2025-01-31
5. 选择周期类型：月报
6. 输入周期标签：2025年1期
7. 点击生成

## 技术支持

如果遇到问题，请检查：
- 后端服务日志
- 浏览器开发者工具的控制台
- 网络请求是否成功

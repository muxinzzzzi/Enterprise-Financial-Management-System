<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>智能财务对账助手</title>
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
<body class="dashboard-body">
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <div class="brand-mark">R</div>
          <div>
            <h1>智能对账</h1>
            <p>RAG+LLM 企业级合规</p>
          </div>
        </div>

        <nav class="sidebar-nav">
          <div class="nav-section">
            <p class="nav-title">工作台</p>
            <a class="nav-item active" data-view="dashboard">仪表盘</a>
            <a class="nav-item" data-view="invoice">发票管理</a>
            <a class="nav-item" data-view="reports">财务报表</a>
          </div>
          <div class="nav-section">
            <p class="nav-title">智能助手</p>
            <a class="nav-item" data-view="assistant">AI 审核</a>
            <a class="nav-item" data-view="knowledge">知识库</a>
          </div>
        </nav>

        <section class="card compact">
          <h2>当前用户</h2>
          <p class="hint" id="current-user">加载中...</p>
          <button id="logout-btn" class="ghost">退出登录</button>
        </section>

      </aside>

      <main class="content">
        <!-- 仪表盘 -->
        <div data-view-section="dashboard" class="view-section active">
        <header class="topbar">
          <div>
            <p class="eyebrow">财务合规 · RAG 双擎</p>
            <h2>票据对账驾驶舱</h2>
            <p class="hint">自动 OCR / 规则校验 / 风险洞察 / 报表生成</p>
          </div>
          <div class="top-actions">
            <button id="refresh-dashboard" class="ghost">刷新概览</button>
            <button class="primary">新建对账</button>
          </div>
        </header>

        <section class="grid stats">
          <div class="card stat" id="stat-ocr">
            <div class="stat-label">OCR 置信度</div>
            <p id="stat-ocr-value">--</p>
            <span class="badge">质量</span>
          </div>
          <div class="card stat" id="stat-policy">
            <div class="stat-label">政策校验</div>
            <p id="stat-policy-value">--</p>
            <span class="badge warning">合规</span>
          </div>
          <div class="card stat" id="stat-category">
            <div class="stat-label">分类</div>
            <p id="stat-category-value">--</p>
            <span class="badge info">智能分类</span>
          </div>
          <div class="card stat" id="stat-risk">
            <div class="stat-label">异常提示</div>
            <p id="stat-risk-value">--</p>
            <span class="badge danger">风险</span>
          </div>
        </section>

        <section class="card panel">
          <div class="panel-head">
            <div>
              <p class="eyebrow">执行结果</p>
              <h3>报告 & 原始 JSON</h3>
            </div>
            <div class="tabs">
              <button data-tab="report" class="active">Markdown 报告</button>
              <button data-tab="json">原始 JSON</button>
            </div>
          </div>
          <div class="tab-content active" id="tab-report">
            <article id="report" class="markdown-body surface">等待生成报告...</article>
          </div>
          <div class="tab-content" id="tab-json">
            <pre id="result" class="surface">等待调用...</pre>
          </div>
        </section>

        <section class="card">
          <div class="panel-head">
            <div>
              <p class="eyebrow">经营洞察</p>
              <h3>仪表盘</h3>
            </div>
          </div>
          <div class="charts">
            <div id="trend-chart" class="chart-box"></div>
            <div id="category-chart" class="chart-box"></div>
            <div id="risk-chart" class="chart-box"></div>
          </div>
        </section>

        <section class="card two-col">
          <div>
            <p class="eyebrow">API 调用</p>
            <h3>/api/v1/reconciliations/run</h3>
            <form id="api-form" class="stacked">
              <textarea id="api-payload" placeholder='{"documents": [...], "policies": [], "options": {}}'></textarea>
              <button type="submit">调用 /run</button>
            </form>
          </div>
          <div>
            <p class="eyebrow">AI 财务助手</p>
            <h3>问答</h3>
            <form id="assistant-form" class="stacked">
              <textarea id="assistant-question" placeholder="例：本季度差旅成本是多少？"></textarea>
              <button type="submit">提问</button>
            </form>
            <article id="assistant-answer" class="markdown-body assistant-answer surface">等待提问...</article>
          </div>
        </section>
        </div>

        <!-- 发票管理 -->
        <div data-view-section="invoice" class="view-section">
          <header class="topbar">
            <div>
              <p class="eyebrow">发票管理</p>
              <h2>上传与凭证</h2>
              <p class="hint">上传发票，自动分类并生成会计凭证（PDF），支持预览与进度</p>
            </div>
          </header>

          <section class="card">
            <div class="tabs invoice-tabs">
              <button data-invoice-tab="upload" class="active">上传发票</button>
              <button data-invoice-tab="library">发票库</button>
              <button data-invoice-tab="vouchers">凭证库</button>
            </div>

            <div data-invoice-pane="upload" class="invoice-pane active">
              <h3>上传发票</h3>
              <form id="upload-form" class="stacked">
                <label class="file-input">
                  <span>选择或拍摄票据</span>
                  <input type="file" id="file" accept="application/pdf,image/*" capture="environment" required />
                </label>
                <div class="upload-row">
                  <div id="upload-preview" class="preview-box">预览</div>
                  <div class="progress-wrap">
                    <div id="upload-progress" class="progress-bar"></div>
                  </div>
                </div>
                <button type="submit">上传并对账</button>
              </form>
              <section class="card surface" style="margin-top:12px;">
                <h4 style="margin:0 0 8px;">OCR 识别结果</h4>
                <pre id="ocr-preview" class="surface small" style="min-height:120px; padding:12px;">等待上传后显示...</pre>
              </section>
            </div>

            <!-- 发票库 -->
            <div data-invoice-pane="library" class="invoice-pane">
              <h3>发票库</h3>
              <p class="hint">管理所有上传的发票，支持批量选择生成凭证</p>
              <div class="invoice-controls" style="margin-bottom:16px;">
                <input id="library-search" placeholder="搜索文件名/供应商/分类" />
                <input id="library-start" type="date" />
                <input id="library-end" type="date" />
                <button id="library-search-btn" type="button" class="ghost">筛选</button>
                <button id="library-clear-btn" type="button" class="ghost">清除</button>
                <button id="select-all-btn" type="button" class="ghost" style="margin-left:16px;">全选</button>
                <button id="batch-generate-voucher-btn" type="button" class="primary" style="margin-left:8px;">批量生成凭证</button>
              </div>
              <div class="table-wrap">
                <table id="library-table">
                  <thead>
                    <tr>
                      <th><input type="checkbox" id="master-checkbox" /></th>
                      <th>ID</th>
                      <th>文件</th>
                      <th>供应商</th>
                      <th>发票时间</th>
                      <th>金额</th>
                      <th>分类</th>
                      <th>创建时间</th>
                      <th>状态</th>
                      <th>预览</th>
                      <th>操作</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="11">加载中...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- 凭证库 -->
            <div data-invoice-pane="vouchers" class="invoice-pane">
              <h3>凭证库</h3>
              <p class="hint">查看和管理已生成的会计凭证</p>
              <div class="invoice-controls">
                <input id="voucher-search" placeholder="搜索凭证ID/发票信息" />
                <input id="voucher-start" type="date" />
                <input id="voucher-end" type="date" />
                <button id="voucher-search-btn" type="button" class="ghost">筛选</button>
                <button id="voucher-clear-btn" type="button" class="ghost">清除</button>
              </div>
              <div class="table-wrap">
                <table id="voucher-table">
                  <thead>
                    <tr>
                      <th><input type="checkbox" id="voucher-master-checkbox" /></th>
                      <th>凭证ID</th>
                      <th>包含发票</th>
                      <th>总金额</th>
                      <th>生成时间</th>
                      <th>凭证文件</th>
                      <th>Excel文件</th>
                      <th>操作</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="8">加载中...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

          </section>
        </div>

        <!-- 财务报表 -->
        <div data-view-section="reports" class="view-section">
          <header class="topbar">
            <div>
              <p class="eyebrow">财务报表</p>
              <h2>智能报表生成</h2>
              <p class="hint">生成标准财务报表（资产负债表、利润表、现金流量表）以及其他审核报表</p>
            </div>
          </header>

          <!-- 报表类型选择 -->
          <section class="card">
            <div class="tabs financial-report-tabs">
              <button data-financial-tab="balance-sheet" class="active">资产负债表</button>
              <button data-financial-tab="income-statement">利润表</button>
              <button data-financial-tab="cash-flow">现金流量表</button>
              <button data-financial-tab="all-financial">生成所有报表</button>
            </div>
          </section>

          <!-- 标准财务报表 -->
          <section class="card" style="margin-top:16px;">
            <!-- 资产负债表 -->
            <div data-financial-pane="balance-sheet" class="financial-pane active">
                <section class="card two-col" style="margin-top:16px;">
                  <div>
                    <h4>生成资产负债表</h4>
                    <form id="balance-sheet-form" class="stacked">
                      <label>开始日期
                        <input type="date" id="balance-sheet-start" />
                      </label>
                      <label>结束日期
                        <input type="date" id="balance-sheet-end" />
                      </label>
                      <label>期间类型
                        <select id="balance-sheet-period">
                          <option value="month">月度</option>
                          <option value="quarter">季度</option>
                          <option value="year">年度</option>
                        </select>
                      </label>
                      <label>公司名称
                        <input type="text" id="balance-sheet-company" placeholder="可选" />
                      </label>
                      <label>币种
                        <select id="balance-sheet-currency">
                          <option value="CNY">人民币 (CNY)</option>
                          <option value="USD">美元 (USD)</option>
                          <option value="EUR">欧元 (EUR)</option>
                        </select>
                      </label>
                      <button type="submit">生成资产负债表</button>
                    </form>
                  </div>
                  <div>
                    <h4>报表结果</h4>
                    <div id="balance-sheet-loading" class="hint" style="display:none;">生成中...</div>
                    <div style="margin-bottom:12px;">
                      <button id="balance-sheet-pdf-preview" class="ghost" style="display:none;margin-right:8px;">预览PDF</button>
                      <button id="balance-sheet-pdf-download" class="ghost" style="display:none;margin-right:8px;">下载PDF</button>
                      <button id="balance-sheet-ai-btn" class="ghost" style="display:none;">生成AI分析</button>
                    </div>
                    <article id="balance-sheet-output" class="markdown-body surface" style="max-height:600px;overflow-y:auto;">等待生成...</article>
                    <div id="balance-sheet-ai" style="margin-top:16px;display:none;">
                      <h5>AI分析</h5>
                      <article id="balance-sheet-ai-content" class="markdown-body surface" style="max-height:300px;overflow-y:auto;"></article>
                    </div>
                  </div>
                </section>
              </div>

              <!-- 利润表 -->
              <div data-financial-pane="income-statement" class="financial-pane">
                <section class="card two-col" style="margin-top:16px;">
                  <div>
                    <h4>生成利润表</h4>
                    <form id="income-statement-form" class="stacked">
                      <label>开始日期
                        <input type="date" id="income-statement-start" />
                      </label>
                      <label>结束日期
                        <input type="date" id="income-statement-end" />
                      </label>
                      <label>期间类型
                        <select id="income-statement-period">
                          <option value="month">月度</option>
                          <option value="quarter">季度</option>
                          <option value="year">年度</option>
                        </select>
                      </label>
                      <label>公司名称
                        <input type="text" id="income-statement-company" placeholder="可选" />
                      </label>
                      <label>币种
                        <select id="income-statement-currency">
                          <option value="CNY">人民币 (CNY)</option>
                          <option value="USD">美元 (USD)</option>
                          <option value="EUR">欧元 (EUR)</option>
                        </select>
                      </label>
                      <button type="submit">生成利润表</button>
                    </form>
                  </div>
                  <div>
                    <h4>报表结果</h4>
                    <div id="income-statement-loading" class="hint" style="display:none;">生成中...</div>
                    <div style="margin-bottom:12px;">
                      <button id="income-statement-pdf-preview" class="ghost" style="display:none;margin-right:8px;">预览PDF</button>
                      <button id="income-statement-pdf-download" class="ghost" style="display:none;margin-right:8px;">下载PDF</button>
                      <button id="income-statement-ai-btn" class="ghost" style="display:none;">生成AI分析</button>
                    </div>
                    <article id="income-statement-output" class="markdown-body surface" style="max-height:600px;overflow-y:auto;">等待生成...</article>
                    <div id="income-statement-ai" style="margin-top:16px;display:none;">
                      <h5>AI分析</h5>
                      <article id="income-statement-ai-content" class="markdown-body surface" style="max-height:300px;overflow-y:auto;"></article>
                    </div>
                  </div>
                </section>
              </div>

              <!-- 现金流量表 -->
              <div data-financial-pane="cash-flow" class="financial-pane">
                <section class="card two-col" style="margin-top:16px;">
                  <div>
                    <h4>生成现金流量表</h4>
                    <form id="cash-flow-form" class="stacked">
                      <label>开始日期
                        <input type="date" id="cash-flow-start" />
                      </label>
                      <label>结束日期
                        <input type="date" id="cash-flow-end" />
                      </label>
                      <label>期间类型
                        <select id="cash-flow-period">
                          <option value="month">月度</option>
                          <option value="quarter">季度</option>
                          <option value="year">年度</option>
                        </select>
                      </label>
                      <label>公司名称
                        <input type="text" id="cash-flow-company" placeholder="可选" />
                      </label>
                      <label>币种
                        <select id="cash-flow-currency">
                          <option value="CNY">人民币 (CNY)</option>
                          <option value="USD">美元 (USD)</option>
                          <option value="EUR">欧元 (EUR)</option>
                        </select>
                      </label>
                      <button type="submit">生成现金流量表</button>
                    </form>
                  </div>
                  <div>
                    <h4>报表结果</h4>
                    <div id="cash-flow-loading" class="hint" style="display:none;">生成中...</div>
                    <div style="margin-bottom:12px;">
                      <button id="cash-flow-pdf-preview" class="ghost" style="display:none;margin-right:8px;">预览PDF</button>
                      <button id="cash-flow-pdf-download" class="ghost" style="display:none;margin-right:8px;">下载PDF</button>
                      <button id="cash-flow-ai-btn" class="ghost" style="display:none;">生成AI分析</button>
                    </div>
                    <article id="cash-flow-output" class="markdown-body surface" style="max-height:600px;overflow-y:auto;">等待生成...</article>
                    <div id="cash-flow-ai" style="margin-top:16px;display:none;">
                      <h5>AI分析</h5>
                      <article id="cash-flow-ai-content" class="markdown-body surface" style="max-height:300px;overflow-y:auto;"></article>
                    </div>
                  </div>
                </section>
              </div>

              <!-- 生成所有财务报表 -->
              <div data-financial-pane="all-financial" class="financial-pane">
                <section class="card" style="margin-top:16px;">
                  <h4>生成所有财务报表</h4>
                  <form id="all-financial-reports-form" class="stacked">
                    <div class="two-col">
                      <div>
                        <label>开始日期
                          <input type="date" id="all-financial-start" />
                        </label>
                        <label>结束日期
                          <input type="date" id="all-financial-end" />
                        </label>
                        <label>期间类型
                          <select id="all-financial-period">
                            <option value="month">月度</option>
                            <option value="quarter">季度</option>
                            <option value="year">年度</option>
                          </select>
                        </label>
                      </div>
                      <div>
                        <label>公司名称
                          <input type="text" id="all-financial-company" placeholder="可选" />
                        </label>
                        <label>币种
                          <select id="all-financial-currency">
                            <option value="CNY">人民币 (CNY)</option>
                            <option value="USD">美元 (USD)</option>
                            <option value="EUR">欧元 (EUR)</option>
                          </select>
                        </label>
                      </div>
                    </div>
                    <button type="submit">生成所有财务报表</button>
                  </form>
                  <div id="all-financial-loading" class="hint" style="display:none;margin-top:16px;">生成中，请稍候...</div>
                  <div id="all-financial-output" style="margin-top:16px;">
                    <div class="tabs">
                      <button data-all-financial-tab="balance-sheet" class="active">资产负债表</button>
                      <button data-all-financial-tab="income-statement">利润表</button>
                      <button data-all-financial-tab="cash-flow">现金流量表</button>
                    </div>
                    <div data-all-financial-content="balance-sheet" class="financial-content active">
                      <div style="margin-bottom:12px;">
                        <button id="all-financial-balance-sheet-pdf-preview" class="ghost" style="display:none;margin-right:8px;">预览PDF</button>
                        <button id="all-financial-balance-sheet-pdf-download" class="ghost" style="display:none;margin-right:8px;">下载PDF</button>
                        <button id="all-financial-balance-sheet-ai-btn" class="ghost" style="display:none;">生成AI分析</button>
                      </div>
                      <article id="all-financial-balance-sheet" class="markdown-body surface" style="max-height:600px;overflow-y:auto;margin-top:12px;">等待生成...</article>
                    </div>
                    <div data-all-financial-content="income-statement" class="financial-content">
                      <div style="margin-bottom:12px;">
                        <button id="all-financial-income-statement-pdf-preview" class="ghost" style="display:none;margin-right:8px;">预览PDF</button>
                        <button id="all-financial-income-statement-pdf-download" class="ghost" style="display:none;margin-right:8px;">下载PDF</button>
                        <button id="all-financial-income-statement-ai-btn" class="ghost" style="display:none;">生成AI分析</button>
                      </div>
                      <article id="all-financial-income-statement" class="markdown-body surface" style="max-height:600px;overflow-y:auto;margin-top:12px;">等待生成...</article>
                    </div>
                    <div data-all-financial-content="cash-flow" class="financial-content">
                      <div style="margin-bottom:12px;">
                        <button id="all-financial-cash-flow-pdf-preview" class="ghost" style="display:none;margin-right:8px;">预览PDF</button>
                        <button id="all-financial-cash-flow-pdf-download" class="ghost" style="display:none;margin-right:8px;">下载PDF</button>
                        <button id="all-financial-cash-flow-ai-btn" class="ghost" style="display:none;">生成AI分析</button>
                      </div>
                      <article id="all-financial-cash-flow" class="markdown-body surface" style="max-height:600px;overflow-y:auto;margin-top:12px;">等待生成...</article>
                    </div>
                  </div>
                </section>
              </div>
            </section>
          </div>
        </div>

        <!-- AI 审核/知识库 占位 -->
        <div data-view-section="assistant" class="view-section">
          <header class="topbar">
            <div>
              <p class="eyebrow">AI 审核</p>
              <h2>智能问答</h2>
              <p class="hint">在“仪表盘”视图中使用右侧问答区，保持体验一致</p>
            </div>
          </header>
        </div>

        <div data-view-section="knowledge" class="view-section">
          <header class="topbar">
            <div>
              <p class="eyebrow">知识库</p>
              <h2>策略与规则</h2>
              <p class="hint">可结合 RAG 与影子规则，后续可添加管理页面</p>
            </div>
          </header>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/static/js/dashboard.js"></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>智能财务对账助手</title>
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
<body class="dashboard-body">
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <div class="brand-mark">R</div>
          <div>
            <h1>智能对账</h1>
            <p>RAG+LLM 企业级合规</p>
          </div>
        </div>

        <nav class="sidebar-nav">
          <div class="nav-section">
            <p class="nav-title">工作台</p>
            <a class="nav-item active" data-view="dashboard">仪表盘</a>
            <a class="nav-item" data-view="invoice">发票管理</a>
            <a class="nav-item" data-view="reports">财务报表</a>
          </div>
          <div class="nav-section">
            <p class="nav-title">智能助手</p>
            <a class="nav-item" data-view="assistant">AI 审核</a>
            <a class="nav-item" data-view="knowledge">知识库</a>
          </div>
        </nav>

        <section class="card compact">
          <h2>当前用户</h2>
          <p class="hint" id="current-user">加载中...</p>
          <button id="logout-btn" class="ghost">退出登录</button>
        </section>

      </aside>

      <main class="content">
        <!-- 仪表盘 -->
        <div data-view-section="dashboard" class="view-section active">
        <header class="topbar">
          <div>
            <p class="eyebrow">财务合规 · RAG 双擎</p>
            <h2>票据对账驾驶舱</h2>
            <p class="hint">自动 OCR / 规则校验 / 风险洞察 / 报表生成</p>
          </div>
          <div class="top-actions">
            <button id="refresh-dashboard" class="ghost">刷新概览</button>
            <button class="primary">新建对账</button>
          </div>
        </header>

        <section class="grid stats">
          <div class="card stat" id="stat-ocr">
            <div class="stat-label">OCR 置信度</div>
            <p id="stat-ocr-value">--</p>
            <span class="badge">质量</span>
          </div>
          <div class="card stat" id="stat-policy">
            <div class="stat-label">政策校验</div>
            <p id="stat-policy-value">--</p>
            <span class="badge warning">合规</span>
          </div>
          <div class="card stat" id="stat-category">
            <div class="stat-label">分类</div>
            <p id="stat-category-value">--</p>
            <span class="badge info">智能分类</span>
          </div>
          <div class="card stat" id="stat-risk">
            <div class="stat-label">异常提示</div>
            <p id="stat-risk-value">--</p>
            <span class="badge danger">风险</span>
          </div>
        </section>

        <section class="card panel">
          <div class="panel-head">
            <div>
              <p class="eyebrow">执行结果</p>
              <h3>报告 & 原始 JSON</h3>
            </div>
            <div class="tabs">
              <button data-tab="report" class="active">Markdown 报告</button>
              <button data-tab="json">原始 JSON</button>
            </div>
          </div>
          <div class="tab-content active" id="tab-report">
            <article id="report" class="markdown-body surface">等待生成报告...</article>
          </div>
          <div class="tab-content" id="tab-json">
            <pre id="result" class="surface">等待调用...</pre>
          </div>
        </section>

        <section class="card">
          <div class="panel-head">
            <div>
              <p class="eyebrow">经营洞察</p>
              <h3>仪表盘</h3>
            </div>
          </div>
          <div class="charts">
            <div id="trend-chart" class="chart-box"></div>
            <div id="category-chart" class="chart-box"></div>
            <div id="risk-chart" class="chart-box"></div>
          </div>
        </section>

        <section class="card two-col">
          <div>
            <p class="eyebrow">API 调用</p>
            <h3>/api/v1/reconciliations/run</h3>
            <form id="api-form" class="stacked">
              <textarea id="api-payload" placeholder='{"documents": [...], "policies": [], "options": {}}'></textarea>
              <button type="submit">调用 /run</button>
            </form>
          </div>
          <div>
            <p class="eyebrow">AI 财务助手</p>
            <h3>问答</h3>
            <form id="assistant-form" class="stacked">
              <textarea id="assistant-question" placeholder="例：本季度差旅成本是多少？"></textarea>
              <button type="submit">提问</button>
            </form>
            <article id="assistant-answer" class="markdown-body assistant-answer surface">等待提问...</article>
          </div>
        </section>
        </div>

        <!-- 发票管理 -->
        <div data-view-section="invoice" class="view-section">
          <header class="topbar">
            <div>
              <p class="eyebrow">发票管理</p>
              <h2>上传与凭证</h2>
              <p class="hint">上传发票，自动分类并生成会计凭证（PDF），支持预览与进度</p>
            </div>
          </header>

          <section class="card two-col">
            <div>
              <h3>上传发票</h3>
              <form id="upload-form" class="stacked">
                <label class="file-input">
                  <span>选择或拍摄票据</span>
                  <input type="file" id="file" accept="application/pdf,image/*" capture="environment" required />
                </label>
                <div class="upload-row">
                  <div id="upload-preview" class="preview-box">预览</div>
                  <div class="progress-wrap">
                    <div id="upload-progress" class="progress-bar"></div>
                  </div>
                </div>
                <label>
                  元数据 (可选)
                  <textarea id="meta" placeholder='{"user_email":"boss@example.com"}'></textarea>
                </label>
                <label>
                  自定义政策 (可选)
                  <textarea id="policies" placeholder='[{"title":"差旅制度","content":"单次餐费≤200"}]'></textarea>
                </label>
                <button type="submit">上传并对账</button>
              </form>
            </div>
            <div>
              <h3>已生成凭证</h3>
              <div class="table-wrap">
<<<<<<< HEAD
                <table id="invoice-table">
                  <thead>
                    <tr>
                      <th>文件</th>
                      <th>供应商</th>
                      <th>金额</th>
                      <th>分类</th>
                      <th>状态</th>
                      <th>凭证</th>
=======
                  <div class="invoice-controls">
                    <input id="invoice-search" placeholder="搜索文件名/供应商/分类" />
                    <input id="invoice-start" type="date" />
                    <input id="invoice-end" type="date" />
                    <button id="invoice-search-btn" class="ghost">筛选</button>
                    <button id="invoice-clear-btn" class="ghost">清除</button>
                  </div>
                  <table id="invoice-table">
                  <thead>
                    <tr>
                        <th><input type="checkbox" id="select-all-invoices" /></th>
                        <th>文件</th>
                        <th>供应商</th>
                        <th>发票时间</th>
                        <th>金额</th>
                        <th>分类</th>
                        <th>创建时间</th>
                        <th>状态</th>
                        <th>预览</th>
                        <th>发票</th>
                        <th>操作</th>
>>>>>>> 4fbaa5a (first commit)
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="6">加载中...</td></tr>
                  </tbody>
                </table>
<<<<<<< HEAD
=======
                <div style="margin-top:8px;">
                  <button id="generate-excel-btn" class="primary">生成凭证（Excel）</button>
                </div>
>>>>>>> 4fbaa5a (first commit)
              </div>
            </div>
          </section>
        </div>

        <!-- 财务报表 -->
        <div data-view-section="reports" class="view-section">
          <header class="topbar">
            <div>
              <p class="eyebrow">财务报表</p>
              <h2>按月/季/年编制</h2>
              <p class="hint">基于账务数据，调用 LLM 生成报表与分析</p>
            </div>
          </header>

          <section class="card two-col">
            <div>
              <h3>生成报表</h3>
              <form id="report-form" class="stacked">
                <label>期间类型
                  <select id="report-period">
                    <option value="month">月度</option>
                    <option value="quarter">季度</option>
                    <option value="year">年度</option>
                  </select>
                </label>
                <label>参考日期
                  <input type="date" id="report-date" />
                </label>
                <button type="submit">生成报表</button>
              </form>
            </div>
            <div>
              <h3>报表结果</h3>
              <article id="report-output" class="markdown-body surface">等待生成...</article>
              <pre id="report-summary" class="surface small">--</pre>
            </div>
          </section>
        </div>

        <!-- AI 审核/知识库 占位 -->
        <div data-view-section="assistant" class="view-section">
          <header class="topbar">
            <div>
              <p class="eyebrow">AI 审核</p>
              <h2>智能问答</h2>
              <p class="hint">在“仪表盘”视图中使用右侧问答区，保持体验一致</p>
            </div>
          </header>
        </div>

        <div data-view-section="knowledge" class="view-section">
          <header class="topbar">
            <div>
              <p class="eyebrow">知识库</p>
              <h2>策略与规则</h2>
              <p class="hint">可结合 RAG 与影子规则，后续可添加管理页面</p>
            </div>
          </header>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/static/js/dashboard.js"></script>
  </body>
</html>
